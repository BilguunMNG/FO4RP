// FOS Client

#include "_macros.fos"
#include "_client_defines.fos"
#include "client_gui_h.fos"

const uint AvatarCount = 3;

class AvaScreen : IGUIScreenCallbackShow
{
	AvaScreen()
	{
	
	}
	
	void OnShow( int p0, int p1, int p2 )
	{
	
	}
	
	bool IsChosen()
	{
		return true;
	}
	
}

mixin class MutualAvaButton
{
	uint Index;
	AvaScreen@ Screen;
	
	void construct( uint index, AvaScreen@ screen )
	{
		Index = index;
		@Screen = screen;
	}
	
	void OnMouseClick( int click ) override
	{
		if( click == MOUSE_CLICK_LEFT )
		{
			Button();
		}
	}
}

class AvaActivate : IGUIElementCallbackMouseClick, MutualAvaButton
{	
	AvaActivate( uint index, AvaScreen@ screen )
	{
		construct( index, screen );
	}
	
	void Button( )
	{

	}
}

funcdef void AvatarUploadFuncdef( string file ); // placeholder
void WindowsExplorer_OpenFile( string file, AvatarUploadFuncdef@ func ){} // placeholder

class AvaUpload : IGUIElementCallbackMouseClick, MutualAvaButton
{	
	AvaUpload( uint index, AvaScreen@ screen )
	{
		construct( index, screen );
	}
	
	void Button( )
	{
		WindowsExplorer_OpenFile( "Avatar Files (*.png)\0*.png", AvatarUploadFuncdef(this.AvatarUpload) );
	}
	
	void AvatarUpload( string file )
	{
		SendFileToServer( file );
	}
}

void GUIInit( )
{
	AvaScreen screen();
	
	GUI_CreateScreenIni( CLIENT_SCREEN_AVATAR, "AvaMainPic" )
		.CallbackShow( screen );
	
	string pref = "";
	for( uint i = 0; i < AvatarCount; i++ )
	{
		pref = "Ava" + ( i + 1 );
		GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, pref + "Pic", 0, 0 );
		GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, pref + "Activate", 0, 0 )
			.CallbackMouseClick( AvaActivate( i, screen ) );
		
		GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, pref + "ActivateDn", 0, 0 );
		GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, pref + "Upload", 0, 0 )
			.CallbackMouseClick( AvaUpload( i, screen ) );
			
		GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, pref + "UploadDn", 0, 0 );
	}
	
	GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, "AvaExitBut", 0, 0 );
	GUI_AddScreenElementIni( CLIENT_SCREEN_AVATAR, "AvaExitButDn", 0, 0 );
}
